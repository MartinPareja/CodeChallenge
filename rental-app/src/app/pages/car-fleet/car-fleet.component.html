<div class="container">
  <mat-card class="page-card mat-elevation-z1">
    <mat-card-header>
      <mat-card-title>Available Car Fleet</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p class="description">Select a date range to view and rent available cars.</p>
    </mat-card-content>
  </mat-card>

  <div *ngIf="errorMessage()" class="error-message mat-body-2 text-center">{{ errorMessage() }}</div>

  <mat-card class="mat-elevation-z1 filters-card">
    <mat-card-title>Availability Filter</mat-card-title>
    <mat-card-content [formGroup]="dateFilterForm" class="filter-controls">
      <mat-form-field appearance="outline">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startDatePicker" [formControl]="startDateControl">
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endDatePicker" [formControl]="endDateControl">
        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>
      <div *ngIf="dateFilterForm.errors?.['dateRangeInvalid']" class="error-message mat-body-2">
        End Date must be after Start Date.
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="card-table mt-4" *ngIf="carFleet().length > 0">
    <mat-card-header>
      <mat-card-title>Available Cars ({{ totalCount() }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="carFleet()" class="w-100">
        <ng-container matColumnDef="make">
          <th mat-header-cell *matHeaderCellDef> Make </th>
          <td mat-cell *matCellDef="let element"> {{ element.make }} </td>
        </ng-container>
        <ng-container matColumnDef="model">
          <th mat-header-cell *matHeaderCellDef> Model </th>
          <td mat-cell *matCellDef="let element"> {{ element.model }} </td>
        </ng-container>
        <ng-container matColumnDef="year">
          <th mat-header-cell *matHeaderCellDef> Year </th>
          <td mat-cell *matCellDef="let element"> {{ element.year }} </td>
        </ng-container>
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef> Type </th>
          <td mat-cell *matCellDef="let element"> {{ element.type }} </td>
        </ng-container>
        <ng-container matColumnDef="location">
          <th mat-header-cell *matHeaderCellDef> Location </th>
          <td mat-cell *matCellDef="let element"> {{ element.location }} </td>
        </ng-container>
        <ng-container matColumnDef="isAvailable">
          <th mat-header-cell *matHeaderCellDef> Status </th>
          <td mat-cell *matCellDef="let element">
            <mat-icon [color]="element.isAvailable ? 'primary' : 'warn'">
              {{ element.isAvailable ? 'check_circle' : 'cancel' }}
            </mat-icon>
            <span>{{ element.isAvailable ? 'Available' : 'Rented' }}</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="rent">
          <th mat-header-cell *matHeaderCellDef> Action </th>
          <td mat-cell *matCellDef="let element">
            <button mat-flat-button color="primary" (click)="openRentCarDialog(element)"
              [disabled]="!element.isAvailable || dateFilterForm.invalid">
              Rent it now
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      <mat-paginator
        [length]="totalCount()"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        (page)="handlePageEvent($event)"
        [hidePageSize]="false"
        [pageSizeOptions]="pageSizeOptions"
        aria-label="Select page">
      </mat-paginator>
    </mat-card-content>
  </mat-card>

  <div *ngIf="carFleet().length === 0" class="no-data-message">
    <p>No cars found matching the filters.</p>
  </div>
</div>