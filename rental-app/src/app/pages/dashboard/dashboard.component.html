<div class="container">
  <mat-card class="mat-elevation-z1 disclaimer-card">
    <mat-card-content>
      <p>This dashboard is a developer preview. It will be available only to admins in future versions.</p>
    </mat-card-content>
  </mat-card>

  <div *ngIf="errorMessage()" class="error-message mat-body-2 text-center">{{ errorMessage() }}</div>

  <mat-card class="metrics-card mat-elevation-z1">
    <mat-card-header>
      <mat-card-title>Rental Metrics</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline" class="date-picker-container">
        <mat-label>Select Date</mat-label>
        <input matInput [matDatepicker]="picker" [formControl]="dateControl">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-grid-list cols="3" rowHeight="100px" gutterSize="16px" *ngIf="metrics()">
        <mat-grid-tile>
          <mat-card class="metric-card">
            <mat-card-header>
              <mat-card-title>Total Rentals</mat-card-title>
            </mat-card-header>
            <mat-card-content class="metric-value">
              {{ metrics()?.totalRentals }}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        <mat-grid-tile>
          <mat-card class="metric-card">
            <mat-card-header>
              <mat-card-title>Total Cancellations</mat-card-title>
            </mat-card-header>
            <mat-card-content class="metric-value">
              {{ metrics()?.totalCancellations }}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        <mat-grid-tile>
          <mat-card class="metric-card">
            <mat-card-header>
              <mat-card-title>Cars Not Rented</mat-card-title>
            </mat-card-header>
            <mat-card-content class="metric-value">
              {{ metrics()?.carsNotRented }}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
      </mat-grid-list>
    </mat-card-content>
  </mat-card>

  <div class="date-range-container">
    <mat-card class="mat-elevation-z1">
      <mat-card-title>Car Types Analytics Date Range</mat-card-title>
      <mat-card-content [formGroup]="dateRangeForm">
        <mat-form-field appearance="outline" class="date-picker">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="startDatePicker" [formControl]="startDateControl">
          <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #startDatePicker></mat-datepicker>
        </mat-form-field>
        <mat-form-field appearance="outline" class="date-picker">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="endDatePicker" [formControl]="endDateControl">
          <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #endDatePicker></mat-datepicker>
        </mat-form-field>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="card-table mt-4" *ngIf="topCarTypes()?.length">
    <mat-card-header>
      <mat-card-title>Top Rented Car Types</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="topCarTypes()">
        <ng-container matColumnDef="carType">
          <th mat-header-cell *matHeaderCellDef> Car Type </th>
          <td mat-cell *matCellDef="let element"> {{ element.carType }} </td>
        </ng-container>
        <ng-container matColumnDef="utilizationPercentage">
          <th mat-header-cell *matHeaderCellDef> Utilization </th>
          <td mat-cell *matCellDef="let element"> {{ element.utilizationPercentage | number:'1.2-2' }}% </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="topCarTypesColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: topCarTypesColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>

  <div class="top-cars-container">
    <mat-card class="mat-elevation-z1 filters-card">
      <mat-card-title>Top Rented Cars Filters</mat-card-title>
      <mat-card-content [formGroup]="topCarsFilterForm">
        <mat-form-field appearance="outline">
          <mat-label>Make</mat-label>
          <input matInput [formControl]="makeControl">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Model</mat-label>
          <input matInput [formControl]="modelControl">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <input matInput [formControl]="typeControl">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Location</mat-label>
          <input matInput [formControl]="locationControl">
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <mat-card class="card-table mt-4">
      <mat-card-header>
        <mat-card-title>Top Rented Cars</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="topCars()">
          <ng-container matColumnDef="make">
            <th mat-header-cell *matHeaderCellDef> Make </th>
            <td mat-cell *matCellDef="let element"> {{ element.car.make }} </td>
          </ng-container>
          <ng-container matColumnDef="model">
            <th mat-header-cell *matHeaderCellDef> Model </th>
            <td mat-cell *matCellDef="let element"> {{ element.car.model }} </td>
          </ng-container>
          <ng-container matColumnDef="year">
            <th mat-header-cell *matHeaderCellDef> Year </th>
            <td mat-cell *matCellDef="let element"> {{ element.car.year }} </td>
          </ng-container>
          <ng-container matColumnDef="rentalCount">
            <th mat-header-cell *matHeaderCellDef> Rental Count </th>
            <td mat-cell *matCellDef="let element"> {{ element.rentalCount }} </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="topCarsColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: topCarsColumns;"></tr>
        </table>
        <mat-paginator
          [length]="topCarsTotalCount()"
          [pageSize]="topCarsPageSize"
          [pageIndex]="topCarsPageIndex"
          (page)="handlePageEvent($event)"
          [hidePageSize]="false"
          [pageSizeOptions]="[5, 10, 20]"
          aria-label="Select page">
        </mat-paginator>
      </mat-card-content>
    </mat-card>
  </div>
</div>